# https://dev.azure.com/home-assistant

parameters:
  artifactFeed: '2df3ae11-3bf6-49bc-a809-ba0d340d6a6d'
  keyfile: ''
  build: ''


steps:
- script: |
    python --version > .cache
  displayName: 'Set python version for requirement cache'
- task: 1ESLighthouseEng.PipelineArtifactCaching.RestoreCacheV1.RestoreCache@1
  displayName: 'Restore artifacts based on Requirements'
  inputs:
    keyfile: '${{ parameters.keyfile }}'
    targetfolder: './venv'
    vstsFeed: '${{ parameters.artifactFeed }}'
- script: |
    ${{ parameters.build }}
  displayName: 'Create Virtual Environment & Install Requirements'
  condition: and(succeeded(), ne(variables['CacheRestored'], 'true'))
# Explicit Cache Save (instead of using RestoreAndSaveCache)
# Dont wait with cache save for all the other task in this job to complete (Â±30 minutes), other parallel jobs might utilize this
- task: 1ESLighthouseEng.PipelineArtifactCaching.SaveCacheV1.SaveCache@1
  displayName: 'Save artifacts based on Requirements'
  inputs:
    keyfile: '${{ parameters.keyfile }}'
    targetfolder: './venv'
    vstsFeed: '${{ parameters.artifactFeed }}'
- script: |
    . venv/bin/activate

    pip install -e .
  displayName: 'Install Home Assistant'
